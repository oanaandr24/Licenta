<app-header></app-header>
<div class="page-container">
  <div class="flex justify-content-start mt-2 -ml-3">
    <p-button
      [text]="true"
      (click)="onBack()"
      icon="pi pi-arrow-left"
      iconPos="left"
      severity="contrast"
      label="Înapoi"
    ></p-button>
  </div>
  <h2>Statistici</h2>

  <div class="flex gap-3">
    <p-card header="Total facturi - Luna curentă" styleClass="mb-4">
      <p-chart
        type="polarArea"
        [data]="chartDataCurrentMonth"
        width="25em"
        height="25em"
        [options]="chartMonthOptions"
      ></p-chart>
    </p-card>

    <p-card header="Facturi plătite">
      <div class="flex flex-column justify-content-start gap-3">
        <div class="flex align-items-center gap-4">
          <label>Factură: </label>
          <p-dropdown
            [options]="['apa', 'gaz', 'electricitate']"
            [(ngModel)]="selectedType"
            placeholder="Alege tipul facturii"
            name="selectedType"
            (ngModelChange)="onChangeType()"
          ></p-dropdown>
        </div>
        <div class="flex align-items-center gap-3">
          <label>Perioadă:</label>
          <p-calendar
            selectionMode="range"
            [(ngModel)]="selectedDates"
            dateFormat="yy-mm-dd"
            name="selectedDates"
            [ngModelOptions]="{ standalone: true }"
          ></p-calendar>
          <button pButton label="Caută" (click)="applyFilters()"></button>
        </div>
      </div>

      <div *ngIf="showChart" class="mt-6">
        <p-chart
          type="bar"
          [data]="chartDataFiltered"
          [responsive]="true"
          [options]="chartFilterOptions"
        ></p-chart>
      </div>
      <div *ngIf="noData" class="mt-5">
        <h4>Nu au fost găsite facturi achitate în acest interval.</h4>
      </div>
    </p-card>

    <p-card header="Facturi neachitate" styleClass="mb-4">
      <div class="p-table-wrapper">
        <p-table [value]="unpaidBills" class="p-table-sm">
          <ng-template pTemplate="header">
            <tr>
              <th>Tip</th>
              <th>Scadență</th>
              <th>Valoare</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-bill>
            <tr>
              <td>{{ bill.type }}</td>
              <td>{{ bill.dueDate }}</td>
              <td>{{ bill.paymentValue }} RON</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </p-card>
  </div>
</div>
